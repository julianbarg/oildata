---
title: "inconsistencies_in_the_data"
author: "Julian Barg"
date: "02/03/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Inconsistencies in the data

There are some minor inconsistencies in the data. They are not extensive enough to justify for us to investigate them further, but regardless I wanted to document them here for future reference.

Note: This document should be updated if the individual unprocessed original datasets are removed fromthe /data folder. In that case, the user should be prompted to download the individual datasets and run the transformations provided in data-raw/util/process_phmsa_data.R and the use the original datasets that should then be saved to data-raw/.temp_data.

```{r packages}
library(oildata)
library(tidyverse)
```

```{r load data}
compare_cols <- vars(year, commodity, ID, name, hca_total, hca_offshore, hca_onshore, miles_total, 
                     miles_onshore, miles_offshore)
pipelines_2004 <- select(pipelines_2004, !!! compare_cols)
pipelines_2010 <- select(pipelines_2010, !!! compare_cols)

pipelines <- rbind(pipelines_2004, pipelines_2010)
head(pipelines)
```

### Inconsistency in total miles

```{r inconsistency_miles}
subset(pipelines, miles_total - miles_offshore - miles_onshore > 1) %>%
  select(-c(hca_total, hca_onshore, hca_offshore))
```

```{r get_name}
subset(pipelines, ID == 99001 & year == 2007, name)
```

<mark>This is the only observation we really ought to pay attention to.</mark>

### Inconsistency in hca miles

```{r inconsistency_hca}
subset(pipelines, hca_total - hca_offshore - hca_onshore > 1) %>%
  select(-c(miles_total, miles_onshore, miles_offshore)) %>%
  print(n = 1000)
```
